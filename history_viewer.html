<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Historiales</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <nav class="main-nav">
    <a href="index.html">Inicio</a>
    <a href="sinoptico.html">SinÃ³ptico</a>
    <a href="listado_maestro.html">Listado maestro</a>
    <a href="insumos.html">Insumos</a>
    <button id="toggleTheme">ðŸŒ™</button>
  </nav>
  <h1>Historiales</h1>
  <div id="historyContainer"></div>
  <script src="auth.js"></script>
  <script src="history_utils.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const cont = document.getElementById('historyContainer');
      if (sessionStorage.getItem('isAdmin') !== 'true') {
        cont.textContent = 'Acceso restringido';
        return;
      }
      const keys = Object.keys(localStorage).filter(k => k.endsWith('History'));
      if (!keys.length) {
        cont.textContent = 'No hay historiales disponibles';
        return;
      }
      keys.forEach(k => {
        const section = document.createElement('section');
        const h2 = document.createElement('h2');
        h2.textContent = k;
        section.appendChild(h2);
        const history = loadHistory(k);
        history.forEach((entry, idx) => {
          const wrap = document.createElement('div');
          const label = document.createElement('span');
          label.textContent = entry.timestamp;
          const dl = document.createElement('button');
          dl.textContent = 'Descargar';
          dl.addEventListener('click', () => {
            const blob = new Blob([JSON.stringify(entry.data, null, 2)], {type:'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = k + '_' + idx + '.json';
            a.click();
            URL.revokeObjectURL(url);
          });
          wrap.appendChild(label);
          wrap.appendChild(dl);
          section.appendChild(wrap);
        });
        cont.appendChild(section);
      });
    });
  </script>
  <script src="theme.js" defer></script>
  <script src="smooth-nav.js" defer></script>
</body>
</html>
